\chapter{Umsetzung}

%\section{Konfiguration}
Die Sensoren werden an einen Raspberry Pi angeschlossen und melden die
gemessenen Werte an einen zentralen Raspberry Pi. Der zentrale Raspberry Pi legt
die gemeldeten Daten in einer Datenbank ab. Eine Website greift auf die
Datenbank zu und stellt die Daten dar.\\
Die Kommunikation wird über ein eigenes WLAN-Netz abgewickelt das von der
Zentraleinheit aufgespannt wird. IP-Adressen werden von einem DHCP-Server, der
auf der Zentraleinheit installiert ist vergeben.\\
Die Website wird durch einen Apache-Webserver auf der Zentraleinheit
bereitgestellt.

\section{Netzwerkkonfiguration}


\subsection{WLAN}

Es wird ein Funknetz auf Basis des 802.11n Standards verwendet. Als Name wurde
Pinet festgelegt, der von allen gesehen werden kann. In der Tabelle
(\nameref{tab:WLAN-Konfiguration}) sind die einzelnen Optionen
aufgeführt und erläutert.


\begin{table}
\caption{WLan-Konfigurationsdetails}
\label{tab:WLAN-Konfiguration}
\begin{tabular}{p{0.5\textwidth} p{0.45\textwidth}}
Befehl & Erklärung \\
interface=wlan0 & Das Interface auf dem das Funknetz ausgestrahlt wird \\
ssid=Pinet & Der name des Funknetzes \\
country\_code=DE & Über die Festlegung der Region wird sichergestellt, dass das
Funknetz die spezifischen Grenzwerte für Kanäle oder Sendestärke einhält \\
hw\_mode=g & legt fest, dass das Funknetz im 2,4 GHz-Band ausgestrahlt wird \\
channel=6 & Der Funkkanal 6 wird verwendet \\
macaddr\_acl=0 & MAC-Adressenfilterung ist deaktiviert \\
auth\_algs=1 & Legt fest, dass als Verschlüsselung WPA verwendet wird \\
ignore\_broadcast\_ssid=0 & Die SSID wird ausgestrahlt und nicht versteckt. \\
wpa=2 & Legt die WPA-Version fest auf WPA2 \\
wpa\_passphrase=IrgendeinbloedesPasswort & Legt den Pre-Shared-Key fest \\
wpa\_key\_mgmt=WPA-PSK & Legt fest, dass ein Pre-Shared-Key verwendet wird \\
wpa\_pairwise=CCMP & Legt fest, dass nur der AES-Verschlüsselungsalgorithmus
verwendet wird \\
wpa\_group\_rekey=86400 & Legt fest, dass alle 86400 Sekunden ein neuer
Schlüssel verwendet werden muss \\
ieee80211n=1 & Aktiviert den n-Standard \\
wme\_enabled=1 & Aktiviert Quality-of-Service - Voraussetzung für die Verwendung
des n-Standards \\
 \end{tabular}
\end{table}

\subsection{DHCP}

Als DHCP-Server wird der ISC-DHCP-Server verwendet.\\
Die IP-Adressen werden nur über das wlan0-Interface der Zentraleinheit vergeben.
Als Netz wurde das Private Netz 192.168.178.0 /24 verwendet. In diesem Netz hat
Die Zentraleinheit als DHCP-Server die Adresse 192.168.178.1 /24. Diese Adresse
ist Statisch eingetragen. Alle anderen Geräte erhalten dynamische IP-Adressen
aus dem Bereich 192.168.178.10 - 192.168.178.250. Die Lease-Time wurde auf
604800 sekunden festgelegt. Dies entspricht 7 Tagen. Da nur wenige Geräte im
Netz verfügbar sind und auch keine häufigen Änderungen erwartet werden wird dies
als ausreichend angesehen.

\begin{verbatim}
/etc/dhcp/dhcpd.conf

#Rogue-DHCP-Server nicht erlauben (Doppelter DHCP-Server)
authoritative;

#Definition des Subnetzes
subnet 192.168.178.0 netmask 255.255.255.0
{
        #Angabe der DHCP-Range
        range 192.168.178.10 192.168.178.250;

        #Angabe der Lease-Times 7 Tage in sekunden
        default-lease-time 604800;
        max-lease-time 604800;

        #Begrenzung auf das WLAN-Interface
        interface wlan0;
}

\end{verbatim}
%TODO: Müssen schauen, wo wir das hinpacken
%\subsection{Verschlüsselung}
%
%Das WLAN ist mit WPA2 verschlüsselt. WPA2 gilt aktuell als sicher, was nicht
% für die Alternativen WEP oder WPA gilt. Zur Authentifizierung wird ein
%Pre-Shared-Key (PSK) verwendet.

\subsection{Mesh}
\section{Sensorknoten} %Allgemein Vorinstalation!
\subsection{Verdrahtung der Sensoren}
\subsection{Implementierung der Sensoren}
\subsection{Konfiguraton \& Testen der Sensoren}
\subsection{Priorisierung der Sensoren}
\subsection{Übertragung der Sensordaten}

\section{Zentraleinheit}%Allgemein Vorinstalation!
\subsection{Empfagen der Sensordaten}
\subsection{Befüllen der Datenbank}
\subsection{Problematik Zeitsynchronisierung}
 
\section{Website}

\subsection{Login}

Der Login, die Registrierung und der Logout ist nach der Anleitung von
wikiHow erstellt und entsprechend angepasst worden. (\cite{PHP-Login})
\\
Der Login besteht aus mehreren Dateien, deren Funktion in der Tabelle
(\nameref{tab:Login-Dateien}) aufgezählt ist.

\begin{table}
\caption{PHP-Login-Dateien und Funktion}
\label{tab:Login-Dateien}
\begin{tabular}{p{0.5\textwidth} p{0.45\textwidth}}
Datei & Erklärung \\
Login.php & Die Loginseite - Gleichzeitig auch die Startseite bei Aufruf der
Server-IP\\
Register.php & Die Registrierungsseite \\
Register\_success.php & Die Seite, die nach einer erfolgreichen Registrierung
angezeigt wird \\
Logout.php & Die Seite, die nach einem erfolgreichen Logout angezeigt wird \\
psl\_config.php & Festlegung von Variablen, die mehrfach verwendet werden \\
db-connect.php & Datenbank-Connector \\
functions.php & Relevante Funktionen, die benötigt werden \\
process\_login.php & Code der die Logindaten der Loginseite überprüft und danach
weiterleitet \\
register\_inc & Code der abläuft wenn sich ein User neu registriert \\
forms.js & Javascriptdatei, für das Hashen und überprüfen der Passwörter \\
sha512.js & Hashfunktion \\
style.css & CSS-Datei für zentrale Designeinstellungen \\
 \end{tabular}
\end{table}

In der Datei functions.php sind zentrale Funktionen gesammelt, die nachfolgend
beschrieben werden:

\subsubsection{sec\_session\_start}
Diese Funktion vergibt eine Session-ID

\subsubsection{login}
Diese Funktion steuert alle notwendigen abläufe den Login betreffend.

\subsubsection{checkbrute}

\subsubsection{login\_check}
Diese Funktion prüft ob ein Anwender eingeloggt ist und setzt den entsprechenden
Parameter, der dann entscheidet was der Anwender auf der Website sieht.

\subsubsection{esc\_url}


\subsection{Übersicht}

\subsection{Statistik}

\subsection{Webcam}

\subsection{Impressum}

\section{Refactoring}
\section{Systemtest}
